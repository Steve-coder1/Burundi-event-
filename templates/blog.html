{% extends 'base_public.html' %}
{% block content %}
<section class="title-row">
  <h1>Blog / News</h1>
</section>

<div class="grid blog-layout">
  <section>
    <form method="get" class="filters" id="blog-filter-form">
      <input type="text" name="keyword" id="blog-search" placeholder="Search posts" value="{{ request.args.get('keyword', '') }}">
      <select name="category" id="blog-category-filter">
        <option value="">All categories</option>
        {% for category in post_categories %}
          <option value="{{ category.id }}" {% if request.args.get('category') == category.id|string %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>
      <button class="btn" type="submit">Search</button>
    </form>

    <div class="blog-grid" id="blog-grid">
      {% for post in posts %}
      <a href="{{ url_for('blog_post_detail', post_id=post.id, lang=current_public_lang_segment) }}" class="event-card blog-card" data-title="{{ post.title|lower }}" data-category="{{ post.category_id }}">
        {% if post.image %}
          <img src="{{ url_for('static', filename='uploads/' + post.image) }}" alt="{{ post.title }}">
        {% else %}
          <div class="image-placeholder">No image</div>
        {% endif %}
        <div class="event-card-body">
          <span class="badge">{{ post.category }}</span>
          <h3>{{ post.title }}</h3>
          <p>{{ post.published }}</p>
          <p>{{ post.excerpt }}</p>
        </div>
      </a>
      {% else %}
      <p>No posts available.</p>
      {% endfor %}
    </div>

    <div class="pagination">
      {% if pagination.has_prev %}<a href="{{ url_for('blog_home', lang=current_public_lang_segment, page=pagination.prev_num, keyword=request.args.get('keyword', ''), category=request.args.get('category', '')) }}">Previous</a>{% endif %}
      <span>Page {{ pagination.page }} / {{ pagination.pages or 1 }}</span>
      {% if pagination.has_next %}<a href="{{ url_for('blog_home', lang=current_public_lang_segment, page=pagination.next_num, keyword=request.args.get('keyword', ''), category=request.args.get('category', '')) }}">Next</a>{% endif %}
    </div>
  </section>

  <aside class="card sidebar-widget">
    <h3>Search</h3>
    <form method="get" class="form-grid">
      <input type="text" name="keyword" placeholder="Search posts...">
      <button class="btn" type="submit">Go</button>
    </form>

    <h3>Recent Posts</h3>
    <ul>
      {% for item in recent_posts %}
      <li><a href="{{ url_for('blog_post_detail', post_id=item.id, lang=current_public_lang_segment) }}">{{ item.title }}</a></li>
      {% endfor %}
    </ul>

    <h3>Categories</h3>
    <ul>
      {% for category in post_categories %}
      <li><a href="{{ url_for('blog_home', lang=current_public_lang_segment, category=category.id) }}">{{ category.name }}</a></li>
      {% endfor %}
    </ul>
  </aside>
</div>
{% endblock %}
