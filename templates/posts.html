{% extends 'base.html' %}
{% block content %}
<div class="title-row">
  <h1>Blog Posts Management</h1>
  <a class="btn" href="{{ url_for('add_post') }}">Add Post</a>
</div>
<form method="get" class="filters">
  <input type="text" name="keyword" placeholder="Search keyword" value="{{ request.args.get('keyword', '') }}">
  <input type="date" name="date" value="{{ request.args.get('date', '') }}">
  <select name="category">
    <option value="">All categories</option>
    {% for category in post_categories %}
      <option value="{{ category.id }}" {% if request.args.get('category') == category.id|string %}selected{% endif %}>{{ category.name }}</option>
    {% endfor %}
  </select>
  <button class="btn" type="submit">Filter</button>
</form>
<table>
  <thead><tr><th>Title</th><th>Published</th><th>Categories</th><th>Actions</th></tr></thead>
  <tbody>
    {% for post in posts %}
    <tr>
      <td>{{ post.title }}</td>
      <td>{{ post.published_at.strftime('%Y-%m-%d %H:%M') }}</td>
      <td>{{ post.categories | map(attribute='name') | join(', ') }}</td>
      <td>
        <a href="{{ url_for('edit_post', post_id=post.id) }}">Edit</a>
        <form method="post" action="{{ url_for('delete_post', post_id=post.id) }}" class="inline" onsubmit="return confirm('Delete post?');">
          <button type="submit" class="text-btn">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
